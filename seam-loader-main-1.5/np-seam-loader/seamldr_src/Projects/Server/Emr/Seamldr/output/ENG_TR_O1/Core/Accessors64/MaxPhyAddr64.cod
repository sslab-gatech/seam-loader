; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.24245.0 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	GetMaxPhyAddr
PUBLIC	GetPhyAddrMask
EXTRN	shiftLeft64:PROC
;	COMDAT pdata
pdata	SEGMENT
$pdata$GetMaxPhyAddr DD imagerel $LN6
	DD	imagerel $LN6+47
	DD	imagerel $unwind$GetMaxPhyAddr
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$GetPhyAddrMask DD imagerel $LN4
	DD	imagerel $LN4+29
	DD	imagerel $unwind$GetPhyAddrMask
pdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$GetPhyAddrMask DD 010401H
	DD	04204H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$GetMaxPhyAddr DD 020601H
	DD	030021206H
xdata	ENDS
; Function compile flags: /Ogsp
; File d:\work\np_seamldr\gnr\po\pr\public\firmware.security.tdx.np-seamldr\seamldr_src\core\accessors64\maxphyaddr64.c
;	COMDAT GetPhyAddrMask
_TEXT	SEGMENT
GetPhyAddrMask PROC					; COMDAT

; 63   : {

$LN4:
  00000	48 83 ec 28	 sub	 rsp, 40			; 00000028H

; 64   :   return shiftLeft64 (1,  GetMaxPhyAddr ()) - 1;     // Sighting #3865410

  00004	e8 00 00 00 00	 call	 GetMaxPhyAddr
  00009	8b d0		 mov	 edx, eax
  0000b	b9 01 00 00 00	 mov	 ecx, 1
  00010	e8 00 00 00 00	 call	 shiftLeft64
  00015	48 ff c8	 dec	 rax

; 65   : }

  00018	48 83 c4 28	 add	 rsp, 40			; 00000028H
  0001c	c3		 ret	 0
GetPhyAddrMask ENDP
_TEXT	ENDS
; Function compile flags: /Ogsp
; File d:\work\np_seamldr\gnr\po\pr\public\firmware.security.tdx.np-seamldr\seamldr_src\core\accessors64\maxphyaddr64.c
;	COMDAT GetMaxPhyAddr
_TEXT	SEGMENT
GetMaxPhyAddr PROC					; COMDAT

; 33   : {

$LN6:
  00000	40 53		 push	 rbx
  00002	48 83 ec 10	 sub	 rsp, 16

; 34   :   UINT32 CpuInfo[4];                    // 0-eax, 1-ebx, 2-ecx, 3-edx
; 35   : 
; 36   :   //
; 37   :   // Obtain MAXPHYADDR.
; 38   :   //
; 39   :   __cpuid(CpuInfo, 0x80000000);

  00006	33 c9		 xor	 ecx, ecx
  00008	b8 00 00 00 80	 mov	 eax, -2147483648	; ffffffff80000000H
  0000d	0f a2		 cpuid

; 40   : 
; 41   :   if (CpuInfo[0] >= 0x80000008)

  0000f	3d 08 00 00 80	 cmp	 eax, -2147483640	; 80000008H
  00014	72 0b		 jb	 SHORT $LN2@GetMaxPhyA

; 42   :     __cpuid(CpuInfo, 0x80000008);

  00016	b8 08 00 00 80	 mov	 eax, -2147483640	; ffffffff80000008H
  0001b	33 c9		 xor	 ecx, ecx
  0001d	0f a2		 cpuid
  0001f	eb 05		 jmp	 SHORT $LN3@GetMaxPhyA
$LN2@GetMaxPhyA:

; 43   :   else
; 44   :     CpuInfo[0] = 36;

  00021	b8 24 00 00 00	 mov	 eax, 36			; 00000024H
$LN3@GetMaxPhyA:

; 45   : 
; 46   :   return (CpuInfo[0] & 0xFF);

  00026	0f b6 c0	 movzx	 eax, al

; 47   : }

  00029	48 83 c4 10	 add	 rsp, 16
  0002d	5b		 pop	 rbx
  0002e	c3		 ret	 0
GetMaxPhyAddr ENDP
_TEXT	ENDS
END

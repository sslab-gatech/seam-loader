; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.24245.0 

	TITLE	D:\work\np_seamldr\gnr\po\pr\public\firmware.security.tdx.np-seamldr\seamldr_src\Core\Common\CR.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	_Update_CRx
; Function compile flags: /Ogsp
; File d:\work\np_seamldr\gnr\po\pr\public\firmware.security.tdx.np-seamldr\seamldr_src\core\common\cr.c
;	COMDAT _Update_CRx
_TEXT	SEGMENT
_Update_CRx PROC					; COMDAT

; 34   :   UINT32 value_eax = 0;
; 35   : 
; 36   :   //Make sure osxsave and osfxsr are set
; 37   : 
; 38   :   value_eax = __readcr4();

  00000	0f 20 e0	 mov	 eax, cr4

; 39   :   value_eax = value_eax | (CR4_PAE + CR4_SMXE);

  00003	0d 20 40 00 00	 or	 eax, 16416		; 00004020H

; 40   : 
; 41   :   __writecr4(value_eax);

  00008	0f 22 e0	 mov	 cr4, eax

; 42   : 
; 43   :   // SEAMLDR should follow the spec and initialize CR0 explicitly to the value 0x21 (PE + NE bit set, all others are cleared)
; 44   : 
; 45   :   value_eax = CR0_PE + CR0_NE;
; 46   :   __writecr0(value_eax);

  0000b	6a 21		 push	 33			; 00000021H
  0000d	58		 pop	 eax
  0000e	0f 22 c0	 mov	 cr0, eax

; 47   : 
; 48   :   return;
; 49   : }

  00011	c3		 ret	 0
_Update_CRx ENDP
_TEXT	ENDS
END

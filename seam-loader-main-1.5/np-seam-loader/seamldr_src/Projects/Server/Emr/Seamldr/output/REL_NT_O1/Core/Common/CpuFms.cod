; Listing generated by Microsoft (R) Optimizing Compiler Version 19.00.24245.0 

	TITLE	D:\work\np_seamldr\gnr\po\pr\public\firmware.security.tdx.np-seamldr\seamldr_src\Core\Common\CpuFms.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	_GetCpuFms
; Function compile flags: /Ogsp
; File d:\work\np_seamldr\gnr\po\pr\public\firmware.security.tdx.np-seamldr\seamldr_src\core\common\cpufms.c
;	COMDAT _GetCpuFms
_TEXT	SEGMENT
_CpuInfo$ = -16						; size = 16
_GetCpuFms PROC						; COMDAT

; 33   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 10	 sub	 esp, 16			; 00000010H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 34   :   UINT32 CpuInfo[4]; // 0-eax, 1-ebx, 2-ecx, 3-edx
; 35   : 
; 36   :   //
; 37   :   // Obtain FMS
; 38   :   //
; 39   :   __cpuid(CpuInfo, 1);

  00009	33 c0		 xor	 eax, eax
  0000b	8d 7d f0	 lea	 edi, DWORD PTR _CpuInfo$[ebp]
  0000e	40		 inc	 eax
  0000f	33 c9		 xor	 ecx, ecx
  00011	53		 push	 ebx
  00012	0f a2		 cpuid
  00014	8b f3		 mov	 esi, ebx
  00016	5b		 pop	 ebx
  00017	89 07		 mov	 DWORD PTR [edi], eax
  00019	89 77 04	 mov	 DWORD PTR [edi+4], esi
  0001c	89 4f 08	 mov	 DWORD PTR [edi+8], ecx
  0001f	89 57 0c	 mov	 DWORD PTR [edi+12], edx

; 40   : 
; 41   :   return CpuInfo[0] & CPUID_FMS_MASK;

  00022	8b 45 f0	 mov	 eax, DWORD PTR _CpuInfo$[ebp]
  00025	5f		 pop	 edi
  00026	5e		 pop	 esi
  00027	25 f0 0f ff 0f	 and	 eax, 268374000		; 0fff0ff0H
  0002c	5b		 pop	 ebx

; 42   : }

  0002d	8b e5		 mov	 esp, ebp
  0002f	5d		 pop	 ebp
  00030	c3		 ret	 0
_GetCpuFms ENDP
_TEXT	ENDS
END
